# Usa uma imagem base oficial e estável do Ubuntu
FROM ubuntu:22.04

# Instala as dependências: compilador C, OpenMPI e bibliotecas.
# 'ENV DEBIAN_FRONTEND=noninteractive' previne que a instalação pare pedindo inputs.
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && \
    apt-get install -y build-essential openmpi-bin libopenmpi-dev && \
    rm -rf /var/lib/apt/lists/*

# Define o diretório de trabalho dentro do container
WORKDIR /app

# Copia o código da engine para o container
COPY . .

# Compila o código DENTRO do container
RUN mpicc -fopenmp -o engine Engine_MPI_OpenMP.c

# Expõe a porta do socket
EXPOSE 8080

# Comando padrão: executa UMA instância da engine
CMD ["./engine"]
